<html>
<head>
  <meta http-equiv="pragma" content="no-cache" />
  <meta http-equiv="expires" content="-1">

  <script src="promise-3.2.0.js"></script>
  <script src="three.min.js" type="text/javascript"></script>
  <script src="quadnet.js" type="text/javascript"></script>
  <script src="highscore.js" type="text/javascript"></script>
  <script src="quadnet-setup.js" type="text/javascript"></script>
  <script src="3dobjects.js" type="text/javascript"></script>
</head>

<style>
body {
  margin: 0 0 0 0;
  overflow: hidden;
}
#quadnet, #canvas-container {
  width:100%;
  height:100%;
  background-color: black;
}

@font-face {font-family: imagine; src: url(font/imagine_font.ttf);}
@font-face {font-family: telegrama; src: url(font/telegrama_render.otf);}
.quadnet-screen {position: absolute;top: 0; left: 0; width: 100%; height: 100%; font-family: imagine;}

#quadnet-hud {color: #0e0; font-size: 100%;}
#quadnet-hud .display, .label {font-size: 200%}
#quadnet-hud table .label {width: 200px}
#quadnet-hud table .content.score {width: 150px; text-align: right}

#quadnet-hud, #quadnet-welcome-screen, #quadnet-instructions-screen {display: none;}


#quadnet-welcome-screen, #quadnet-instructions-screen  {
  background-color: black;
  color: #ee9a12;
}

.overlay {
  top: 0px;
  left: 0px;
  position: absolute;
  width: 100%;
  height: 100%;
}

table {
  color: inherit;
  font-family: inherit;
}

#quadnet-highscore-screen {
  text-align: center;
  color: white;
  background: url('img/background.jpg');
  background-size:100% 100%;  
}

#quadnet-highscore-screen table.highscores {
  width: 100%;
  font-size:150%;
  font-family: telegrama;
  background-color: black;
  border: 4px solid green;
}

#quadnet-highscore-screen table.highscores td {
  border-bottom: 1px solid green;
}
#quadnet-highscore-screen table.highscores th {
  border-bottom: 3px solid green;
}

#quadnet-highscore-screen table.highscores td.score {
  text-align: right;
}

#quadnet-highscore-screen table.highscores td.name {
  text-align: left;
}

#quadnet-highscore-screen form {
  margin: 0;
}

#quadnet-highscore-screen input {
  background-color: black;
  font-family: telegrama;
  color: white;
  border: none;
  font-size: 100%;
  width: 100%;
  height: 100%;
}

#quadnet-highscore-screen p.title {
  font-size: 400%;
  text-align: center;
  width: 100%;
  color: #0e0;
  margin-top: 2%;
  margin-bottom: 2%;
}

#quadnet-highscore-screen p.highscore-reached {
  font-size: 200%;
  text-align: center;
  width: 100%;
  color: white;
}

#quadnet-loading-screen {
  text-align: center;
  color: white;
  background: url('img/background.jpg');
  background-size:100% 100%;
}

#quadnet-loading-screen h1 {
  position: relative;
  top: 50%;
  font-family: inherit;
}


#container {
    display: table;
    height: 100%;
    width: 100%;
    margin: 0;
    }

#content {
    display: table-cell;
    vertical-align: middle;
    position: relative;
    }

#inner {
    width: 50%;
    margin: 0 auto;
    padding: 0 20px;
    }

.centered-layer {
  text-align: center;
}

h1.quadnet-title {
  color: #080;
  font-size: 1000%;
  margin-bottom: 0;
}

h2.press-enter {
  color: #fff;
  font-size: 200%;
  margin-top: 1%;
}

a {
  color: #0c0;
}

#quadnet-welcome-screen .centered-layer {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

#quadnet-welcome-screen img.netimage {
  margin-left: auto;
  margin-right: auto;
  margin-top: 12%;
}

div.footer {
  height: auto;
  position: absolute;
  bottom: 0;
  width: 100%;
}

div.credits {
  text-align: left;
}

.footer table {
  font-size:150%;
  width: 100%;
}

table td.left-side {
  width: 50%;
}

table td.middle-side {
  text-align: right;
  width: 10%;
}

table td.right-side {
  text-align: right;
  width: 10%;
}

table td.right-side img {
  width: 45%;
}

#quadnet-instructions-screen table.top p {
  font-size: 400%;
  margin-left: 5%;
  color: #0e0;
}

#quadnet-instructions-screen table {
  width: 100%;
}

#quadnet-instructions-screen table.top {
  height: 10%;
}

#quadnet-instructions-screen table.middle {
  height: 45%;
  font-size: 60%;
  font-family: telegrama;
}

#quadnet-instructions-screen table.bottom {
  height: 45%;
  font-size: 60%;
  font-family: telegrama;
}

#quadnet-instructions-screen table tr {
  width: 100%;
  height: 100%;
}

#quadnet-instructions-screen table tr td.img-td {
  width: 30%;
  text-align: center;
}

#quadnet-instructions-screen table tr td.text-td {
  width: 20%;
  font-size: 300%;
}

#quadnet-instructions-screen table img {
  height: 100%;
}

#quadnet-instructions-screen table tr td.img-td div {
  height: 240px;
}

.quadnet-screen {
  transition: all 0.5s ease-in-out;
}

.quadnet-screen.toup {
  top: -100%;
}

.footer table {
  line-height: 130%;
}

</style>
<body>
  <div id="quadnet">
    <div id="canvas-container">
    </div>
    <div id="quadnet-loading-screen" class="quadnet-screen active">
      <div id="container">
        <div id="content">
          <div id="inner">        
            <h1>LOADING...</h1>
          </div><!-- fin inner -->
        </div><!-- fin content" -->
      </div>
    </div>

    <div id="quadnet-hud" class="quadnet-screen">
      <table>
        <tr><td class='label'>SCORE:</td><td class='content score'><div class='score-display display'>0</div></td></tr>
      </table>
    </div>

    <div id="quadnet-welcome-screen" class="quadnet-screen toup">
      <div class="centered-layer">
        <img class="netimage" src="img/welcomenet.jpg"> </img>
      </div>
      <div class="centered-layer">
        <h1 class="quadnet-title">QUADNET</h1>
        <h2 class="press-enter"><a href="#">Press Enter to Play</a></h1>

        <div class="footer">
          <table>
            <thead>
            </thead>
            <tbody>
              <tr>
                <td class="left-side">
                  <div class="credits">Dario Seminara <br/>
                    <a href="http://github.com/tario/quadnet">http://github.com/tario/quadnet</a><br/>
                    Tribute to 1998's QUADNET <br/>
                    <a href="http://www.martinmagnusson.com/games/quadnet">http://www.martinmagnusson.com/games/quadnet</a>
                  </div>
                </td>
                <td class="middle-side">
                  Share this game with your friends!
                </td>
                <td class="right-side">
                  <img src="img/twitter-button.png"></img>
                  <img src="img/facebook-button.png"></img>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    
    </div>


    <div id="quadnet-instructions-screen" class="quadnet-screen toup">
      <table class="top">
        <tr>
          <td><p>INSTRUCTIONS</p></td>
        </tr>
      </table>
      <table class="middle">
        <tr>
          <td class="img-td">
            <div><img src="img/instr1.jpg"></img></div>
          </td>
          <td class="text-td">
            <p>Use arrow keys to move the ship in all four directions</p>
          </td>
          <td class="img-td">
            <div><img src="img/instr2.gif"></img></div>
          </td>
          <td class="text-td">
            <p>Use WASD to shoot in all four directions</p>
          </td>
        </tr>
      </table>
      <table class="bottom">
        <tr>
          <td class="text-td">
            <p>Evade asteroids to avoid colliding with them</p>
          </td>
          <td class="img-td">
            <div><img src="img/instr3.jpg"></img></div>
          </td>
          <td class="text-td">
            <p>Shoot to destroy asteroids and earn points</p>
          </td>
          <td class="img-td">
            <div><img src="img/instr4.jpg"></img></div>
          </td>
        </tr>
      </table>
    </div>

    <div id="quadnet-highscore-screen" class="quadnet-screen toup">
      <p class="title">HIGHSCORES</p>
      <p class="highscore-reached">Congratulations! your score reach highscore table!</p>

      <div id="container" class="overlay">
        <div id="content">
          <div id="inner">  
            <table class="highscores">
              <thead>
                <th class="name-column">Name</th>
                <th class="score-column">Score</th>
              </thead>
              <tbody>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

  </div>
  <script type="text/javascript">
    window.onload= function(){
      var onGame = false;
      var lastScore;
      var lastScoreHighscore;

      var launch = function() {
        activateScreen("#quadnet-hud");
        quadnet(document, document.getElementById("canvas-container"));
        onGame = true;
      };

      Quadnet.onStop(function(arguments) {
        onGame = false;
        lastScore = arguments.score;
        if (Quadnet.highscore.shouldEnterHighscore(arguments.score)) {
          lastScoreHighscore = true;
          activateScreen("#quadnet-highscore-screen");
        } else {
          activateScreen("#quadnet-welcome-screen");
        }
      });

      var activateScreen = function(name) {
        var currentScreen = document.querySelector(".quadnet-screen.active");
        currentScreen.classList.remove("active");
        setTimeout(function(){currentScreen.style.display = 'none'}, 500);

        document.querySelector(name).style.display = "inline";
        document.querySelector(name).classList.add("active");

        window.onkeydown = function(){};
        (document.querySelector(name).ondisplay || (function(){}) )();
      };

      document.querySelector("#quadnet-highscore-screen").ondisplay = function() {
        var tbody = document.querySelector("#quadnet-highscore-screen div table tbody");
        var html = "";

        tbody.innerHTML = (lastScoreHighscore ? Quadnet.highscore.getAllForInput(lastScore) : Quadnet.highscore.getAll()).
        map(function(obj){
          if (obj.shouldInputName) {
            return "<tr><td class='name'><form><input type='text'></form></input></td><td class='score'>"+obj.score+"</td></tr>";
          } else {
            return "<tr><td class='name'>"+obj.name+"</td><td class='score'>"+obj.score+"</td></tr>";
          }
        }).join("");

        if (lastScoreHighscore) {
          document.querySelector("table.highscores input").focus();
          document.querySelector("table.highscores form").onsubmit = function() {
            Quadnet.highscore.insert(document.querySelector("table.highscores form input").value, lastScore);
            document.querySelector("#quadnet-highscore-screen").classList.add("toup");
            activateScreen("#quadnet-welcome-screen");
            return false;
          };

          document.querySelector("p.highscore-reached").style.display = "inline";

          if (Quadnet.highscore.getAllForInput(lastScore)[0].shouldInputName) {
            Quadnet.music.highscore2({loop: true});
          } else {
            Quadnet.music.highscore({loop: true});
          }
        } else {
          document.querySelector("p.highscore-reached").style.display = "none";
        }

        setTimeout(function() {
          document.querySelector("#quadnet-highscore-screen").classList.remove("toup");
        }, 0);
        
        if (!lastScoreHighscore) {
          window.onkeydown = function(e){
            document.querySelector("#quadnet-highscore-screen").classList.add("toup");
            activateScreen("#quadnet-welcome-screen");
          };
        }
      };

      document.querySelector("#quadnet-welcome-screen").ondisplay = function() {
        setTimeout(function() {
          document.querySelector("#quadnet-welcome-screen").classList.remove("toup");
        }, 0);
        window.onkeydown = function(e){
          if (e.keyCode === 13) {
            document.querySelector("#quadnet-welcome-screen").classList.add("toup");
            activateScreen("#quadnet-instructions-screen");
          };
        };
      };

      document.querySelector("#quadnet-instructions-screen").ondisplay = function() {
        setTimeout(function() {
          document.querySelector("#quadnet-instructions-screen").classList.remove("toup");
        }, 0);
        window.onkeydown = function(e){
          onGame = true;
          document.querySelector("#quadnet-instructions-screen").classList.add("toup");
          launch();
        };
      };

      Quadnet.prepareResources().then(function(){
        document.querySelector(".press-enter a").onclick = function() {
          activateScreen("#quadnet-instructions-screen");
        };
        activateScreen("#quadnet-welcome-screen");
      });
    };
  </script>
</body>
</html>
